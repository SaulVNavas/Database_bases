<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Resaltado dinámico</title>
  <style>
    .monaco-editor .name-style {
      color: #ff4d4f !important;
      font-weight: bold;
    }

    #editor {
      width: 800px;
      height: 400px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div id="editor"></div>
  <div id="counter"></div>

  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script>
    require.config({ paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs" } });

    require(["vs/editor/editor.main"], function () {
      const editor = monaco.editor.create(document.getElementById("editor"), {
        value: "Escribe: bit mundo\nreal prueba\nDespués se repite: mundo prueba",
        language: "plaintext",
        theme: "vs-dark"
      });

      let decorations = [];

      function highlightDynamic() {
        let allDecorations = [];
        let nameWords = new Set();

        // 1️⃣ Buscar todas las frases "hola buenas <palabra>"
        const regex = /(bit|boolean|character|integer|real|string|time|variable)\s+(\w+)/gi;
        const nameRegexMatches = editor.getModel().findMatches(regex.source, null, true, true, null, true);

        // Extraer todas las palabras encontradas (grupo 2)
        for (const nameRegexMatch of nameRegexMatches) {
          if (nameRegexMatch.matches && nameRegexMatch.matches[2]) {
            nameWords.add('\\b' + nameRegexMatch.matches[2] + '\\b');
          }
        }

        // 2️⃣ Resaltar TODAS las ocurrencias de cada palabra encontrada
        nameWords.forEach(nameWord => {
          const nameMatches = editor.getModel().findMatches(nameWord, null, true, true, null, true);
          nameMatches.forEach(nameMatch => {
            allDecorations.push({
              range: nameMatch.range,
              options: { inlineClassName: "name-style" }
            });
          });
        });

        // Aplicar todas las decoraciones
        decorations = editor.deltaDecorations(decorations, allDecorations);

        // Actualizar contador en pantalla
        document.getElementById("counter").innerText = 
          "Palabras detectadas: " + [...nameWords].join(", ") + 
          " | Total coincidencias: " + allDecorations.length;
      }

      // Resaltar al inicio y en tiempo real
      highlightDynamic();
      editor.onDidChangeModelContent(() => highlightDynamic());
    });
  </script>
</body>
</html>
